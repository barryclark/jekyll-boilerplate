---
layout: post
title: 全闪存储
---

#### 传统存储PK全闪存储：成本分析对比
一款产品最能打动消费者或决策者的最直接的因素就是便宜，如果在便宜的基础上还能保证足够的性能的话，那么性价比一词将是最好的宣传卖点。

全闪存储在IOPS或者是延迟最短，还有现在特别流行而且接下来也会成为主方向的软件定义存储和超融合，无论是软件定义存储也好，超融合也好，都是为了充分利用存储资源，同时将节约总支出成本作为整个存储行业的第一主线，如果在这个主线上还能有性能、可用性等方面的提升，那就再好不过。

在行业内，宣传其总拥有成本（TCO）节省高达X％（X在20-80中间）。那么问题来了，到底这些成本是如何节约的？

全闪存储和传统存储阵列相比，在成本的比较上到底有什么区别？

首先，我们的比较一定是需要在特定的场景下进行的；其次，此次比较仅仅是针对购买价格进行比较，所以关于数据的可靠性等维度暂时不做说明；再次，为了便于比较，我们此次的价格比较是存储的总体购置成本（TCA），而不是总拥有成本。

我们在这里以一个客户案例来做比较，20T数据量的存储数据情况下，用传统存储和全闪存储的方案来对比。

维度 | 状态
---|---
存储性能要求| 一般
数据可靠性要求| 中等偏高
成本要求| 高

在20TB数据量的情况下，我们对比的两种解决方案如下：

采用的数据盘 | 采用的存储架构 | 总体购置成本（TCA）
---|---|---
18个1.2T硬盘 | 双控的全闪存储 | 40万
10个2T硬盘 | 双控的传统存储 | 25万

通过以上的比较发现，**（仅从TCA考虑）传统存储比中高端全闪存储的成本优势较为明显，而如果不考虑性能等因素的话，传统存储依然有其存在的空间**。

当然，即使是刚入门的存储小白也知道，高性能必将导致高成本，这就是为什么存储产品会有 **高端、中端、入门（底端）** 之分，不过，从实际印证的结果来看，传统存储的采购成本确实比全闪要低，但是**如果是对性能有要求的话，那么选择全闪存会更好**，虽然成本会有所上升，但是从整体使用效果来看，全闪存储的性价比是远大于传统存储的。

从应用场景角度来分析说的话，**全闪存储是采用了新的NVMe协议的全闪存**。全闪存储更适合高性能、高吞吐、虚拟化整合环境。传统存储一般使用于对性能要求不是特别高，数据转发能力一般的传统环境较多。

> NVMe标准，全称Non-Volatile Memory Express（非易失性存储器标准），是使用PCI-E通道的SSD一种规范，最早在2007年的Intel开发者论坛上已被提出，并在同年由Intel领衔成立了NVMHCI工作组。

> 面向PCIe SSD产品的NVMe标准能有效降低控制器和软件接口部分的延迟，最主要是能让SSD走PCI-E通道直连CPU，有效降低了数据延迟，其次，NVMe精简了调用方式，AHCI每条命令则需要读取4次寄存器，一共会消耗8000次CPU循环，从而造成2.5μs的延迟，而NVMe执行命令时则不需要读取寄存器。

那么如果在相同的高IOPS性能下，闪存对机房空间，能耗方面的节省如何？以IBM最新的闪存设备FS9100来为例，主要从下面几点降低TCO的优势。

①  闪存存储相比传统存储来说，在对传统压缩、去重功能可以最大扩充5倍存储空间，也支持超融合等架构，对数据的压缩比可以达到比较可观的优化比例。

②   闪存高密度，2U空间可提供2PB有效存储，传统存储如果要提供这么大的有效存储，往往需要更大的机柜空间，对机柜的可利用性是一个不小的考验。

③   闪存存储可以最大程度节省机房空间，在能耗上也比相同架构或者性能的传统存储大大降低。  
  
  
   
   
#### 从传统存储切换到闪存阵列面对的问题
传统机械磁盘存储受限于存储架构的发展，很难在速度上进一步突破和提升。更快的闪存存储系统突破了传统机械磁盘系统的物理限制，让数据的读写处理更加快速和高效。然而企业用户也必须考虑：如何运用闪存技术快速解决生产系统IO性能瓶颈或者异常隐患，业务系统所用传统存储又如何快速切换至闪存阵列解决燃眉之急，存储切换时系统停机窗口如何安排和停机、数据迁移风险等等重重问题。

###### （1）如何评估系统所用的传统存储阵列是否已达瓶颈
一般企业在使用传统存储到一定年限的时候就会对存储的性能是否达到瓶颈需要做出判断。对于磁盘IO来说，大的方向，主要看磁盘的IO响应时间。对于OLTP（联机事务处理过程）业务，主要是分为读与写两个点来判断，读IO响应时间5-8ms内算是正常值，写IO响应时间，1-2ms还算ok。高达20ms以上的响应时间，通常都意味着存储内部存在瓶颈。通常而言，这种情况，增加缓存并不能解决性能问题，就需要看看是否可以增加更多物理磁盘（前提是后端磁盘卡处理能力未达到瓶颈）来解决问题。

###### （2）高端传统存储阵列和闪存阵列如何取舍
对于传统磁盘阵列带SSD磁盘，例如现在到处都在宣传的高端全闪存阵列，主要架构并未发生变化，限制性能输出的瓶颈部位还是在后端磁盘卡，以及传统的RAID模式上。在性能方面，比全新架构的全闪存还是有一定差距。

同时，这类闪存，由于架构限制，很难增加压缩和除重功能，性价比也不是最好。但是，这种架构适合原来一直沿用类似高端存储架构的客户，可以方便的过渡到新的平台，获得更好的性能。另外，这一类架构，容灾功能比较丰富，适合有类似三站点需求的客户。在性能得到提升的同时，还可以保留原来所需的功能。

稳定是需要时间和客户环境的不断适错才能获得一个相对稳定的微码环境。因此，传统阵列+SSD磁盘，相对全新设计的全闪存架构，是有一定的优势。通常意义上说，一个经历过10-20年磨砺的代码平台，比发布才3-5年的全新产品，代码成熟度还是要高一点的。另外，如果在高可用上考虑的比较齐全，使用全新闪存架构，也是一种很好的选择。

###### （3）全闪闪存的价值和趋势所在
闪存是存储市场里面最重要的存储趋势，很多企业在实际应用中也或多或少的使用了闪存。由于看准了未来的趋势，不同形式的闪存厂商不计其数，甚至一些厂商和大型用户企业希望用全闪存产品代替磁盘阵列。

趋势1：新厂商不断加入，而市场继续整合

虽然新的存储提供商继续进入全闪存阵列市场，主要关注面向NVMe的阵营，但更大的趋势是继续整合。几乎市场上每个知名供应商至少进行了一次全闪存厂商的并购。因此，一些提供商正在对其全闪存投资组合进行优化

趋势2：闪存容量急剧增加

DCIG公司研究的100多个全闪存阵列的原始容量平均为4.4PB。与2017-2018版的产品相比，增加了5倍。而容量最高的产品可提供70 PB全闪存容量。

趋势3：存储密度显著增加

性能和高存储密度的结合意味着在传统HDD存储系统和第一代全闪存阵列的1/10空间内满足组织的性能和容量要求。这为许多企业和运营商提供了降低数据中心成本的重要机会。

趋势4：统一存储是新常态

第一代全闪存阵列几乎都是仅限于块的SAN阵列。现在的全闪存阵列中有一半以上支持统一存储。这种对多个并发协议的支持，为合并和加速更多类型的工作负载创造了机会。

用户选择使用全闪存储产品可以增加其运行速度，与此同时降低运行成本。具体而言，性能和延时问题可以的得到很大程度的改善，同一套基础设施可供更多的用户进行使用，全闪存阵列可以稳定支持业务高峰，保证服务最大程度时间不中断。现在在企业的很多应用场景中，全闪存储的位置越来越发挥着关键性的作用，即使数据集增长，也能使现有应用程序运行得更快，加速应用程序开发，让IT部门能够接受新工作负载，然后让这些新工作负载在记录时间内产生结果。在关键业务数据库、企业级关键应用、桌面虚拟化、服务器虚拟化以及大数据分析方面将充分发挥自身优势。

#### 三. 传统存储PK全闪存储：各性能对比
传统存储阵列发展的几十年里，确实给数据中心的建设带来了巨大的发展，但是随着虚拟化的普及以及大数据、云计算、互联网+等等概念的落实，传统存储阵列的疲态凸显，在处理能力、扩展性、可维护性、可靠性方面，以及成本考量都呈现出更多地劣势。以下依旧以FS9100为例，可以看到闪存存储技术相对传统存储阵列，从性能上对比具有以下一些明显优势：

3.1 可靠性  
可靠性方面，主要靠架构设计和微码的成熟度。FS9100传承了持续了15年的SpectrumVirtualize协议栈，稳定可靠。

新特性方面，FS9100目前支持硬盘自动压缩的技术。FCM盘，来自F900的FlashCore技术，实现盘内做硬件的数据压缩，减轻控制器CPU的负载，减小了写入闪存颗粒的数据量，大幅提升闪盘的寿命。业界目前有在定制的闪存模块上实现压缩功能，比如HDS的FMD。在单个闪存盘上实现硬件压缩，目前只有FS9100的FCM。这个是业界独有的技术。传统存储的可靠性比全闪存储相比稳定性较差。

3.2 云存储  
在私有云环境中，FS9100非常适合做数据整合。通过一个平台，提供高性能、高吞吐的存储平台。同时，还可以利用外部虚拟化功能，整合已有的存储，通过一个统一的接口，和云平台对接，简化管理，降低管理复杂度。传统存储一般不支持云存储技术。

3.3  具备对卷的QOS能力  
FS9100支持对卷/Pool/控制器进行QoS管理。传统存储一般都不支持此功能。

3.4  公有云部署  
目前与公有云的连接，基本上都是通过S3接口。目前FS9100支持通过S3接口，与AWS/IBMCloud连接。也支持通过Openstack的swift接口，把FS9100的数据，连接到Openstack云上。类似Openstack的私有云平台，通过cinder接口直接连接FS9100存储。传统存储一般不支持公有云部署。

3.5  硬件压缩  
FS9100里面有FCM盘，利用IBM独有的Flascore技术，支持在盘上进行压缩。盘内压缩不需要控制器CPU进行压缩，释放控制器的CPU资源，可以支持更高的IOPS。

3.6  支持的IOPS  
一个FS9100集群支持10M IOPS、136GB/s吞吐和32PB管理容量。其起配配置在2U 机柜就支持2.5M IOPS和34GB/s吞吐，以及2PB的存储空间。

对应的EMC产品：PowerMax 2000，支持1.7M IOPS和1PB容量，PowerMax 8000支持10M IOPS和4PB容量。

3.7  故障冗余  
每个部件都是冗余设计，双电源，双电池，双风扇灯。一个节点故障，另外一个节点接管。部署成Hyperswap双活模式，可以承受最大坏3个控制器。传统存储一般都不支持双活模式。

3.8 支持不同厂商的存储间的异地容灾  
FS9100支持与IBM V系列中端/SVC/V9000做容灾。目前并不支持直接与外部厂商的产品做容灾。但可以通过虚拟化外部存储，然后在FS9100层面实现多个外部存储的整合，与另外的FS9100/SVC/V9000做容灾。传统存储不支持做存储间的异地容灾。

3.9 闪存存储的成本对比传统存储  
FS9100目前支持的容量较大，同时支持硬盘自压缩和软件除重。因此，在衡量每GB的成本时候，需要综合考虑同样配置的V7000占用的空间/空调等使用费用。目前我们并没有一个具体的数值。但是我们可以帮助客户根据具体的容量需求进行评估。

关键指标上，FS9100的IOPS和延时，与V7000F相比是有很高的提升。另外，FS9100支持自压缩的NVMe盘，有效容量方面比V7000F要高2-3倍。

3.10 全闪存存储的外部接口跟传统存储的兼容性  
目前FS9100支持24个16Gb/s的FC接口，吞吐上可以支撑大部分客户的需求。如果FS9100接入传统8Gb的SAN网络，那么接口方面会限制了整个存储的性能发挥。

 

#### 四、结语

综上所述，整体综合对比，在高性能、高吞吐、虚拟化整合环境下，选用全闪存储的性价比远高于传统存储，在处理能力、扩展性、可维护性、可靠性方面，也都具有明显的优势。
